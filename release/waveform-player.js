!function e(t,i,r){function a(s,o){if(!i[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(n)return n(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var u=i[s]={exports:{}};t[s][0].call(u.exports,function(e){var i=t[s][1][e];return a(i||e)},u,u.exports,e,t,i,r)}return i[s].exports}for(var n="function"==typeof require&&require,s=0;s<r.length;s++)a(r[s]);return a}({1:[function(e,t,i){"use strict";function r(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function a(e){return s[e>>18&63]+s[e>>12&63]+s[e>>6&63]+s[63&e]}function n(e,t,i){for(var r,n=[],s=t;s<i;s+=3)r=(e[s]<<16)+(e[s+1]<<8)+e[s+2],n.push(a(r));return n.join("")}i.byteLength=function(e){return 3*e.length/4-r(e)},i.toByteArray=function(e){var t,i,a,n,s,h=e.length;n=r(e),s=new l(3*h/4-n),i=n>0?h-4:h;var u=0;for(t=0;t<i;t+=4)a=o[e.charCodeAt(t)]<<18|o[e.charCodeAt(t+1)]<<12|o[e.charCodeAt(t+2)]<<6|o[e.charCodeAt(t+3)],s[u++]=a>>16&255,s[u++]=a>>8&255,s[u++]=255&a;return 2===n?(a=o[e.charCodeAt(t)]<<2|o[e.charCodeAt(t+1)]>>4,s[u++]=255&a):1===n&&(a=o[e.charCodeAt(t)]<<10|o[e.charCodeAt(t+1)]<<4|o[e.charCodeAt(t+2)]>>2,s[u++]=a>>8&255,s[u++]=255&a),s},i.fromByteArray=function(e){for(var t,i=e.length,r=i%3,a="",o=[],l=0,h=i-r;l<h;l+=16383)o.push(n(e,l,l+16383>h?h:l+16383));return 1===r?(t=e[i-1],a+=s[t>>2],a+=s[t<<4&63],a+="=="):2===r&&(t=(e[i-2]<<8)+e[i-1],a+=s[t>>10],a+=s[t>>4&63],a+=s[t<<2&63],a+="="),o.push(a),o.join("")};for(var s=[],o=[],l="undefined"!=typeof Uint8Array?Uint8Array:Array,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=0,c=h.length;u<c;++u)s[u]=h[u],o[h.charCodeAt(u)]=u;o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},{}],2:[function(e,t,i){"use strict";function r(e,t){for(var i=l.toByteArray(e),r=s.makeNumberArray(i.length),a=0;a<r.length;a++)r[a]=i[a]/255;return r}function a(){var e=window;if(!e.HTMLAudioElement||!e.HTMLCanvasElement)return!1;var t;return"transform"in document.createElement("div").style?"getComputedStyle"in window?Array.prototype.indexOf?window.requestAnimationFrame?Date.now||(t="Date.now"):t="requestAnimationFrame":t="Array.indexOf":t="getComputedStyle":t="CSS transform",!t||(console.error("Unnecessary restriction: this browser support audio and canvas but not "+t+". User agent: "+navigator.userAgent),!1)}Object.defineProperty(i,"__esModule",{value:!0});var n=e("./Track"),s=e("./shared"),o=e("./WaveformRenderer"),l=e("base64-js"),h="disable",u='\n<div class="waveform-player-controls">\n  <button class="waveform-player-controls-toggleplay">toggle play</button>\n  <button class="waveform-player-controls-prev">prev</button>\n  <button class="waveform-player-controls-next">next</button>\n  <div class="waveform-player-controls-peakdata-wrapper">\n    <canvas class="waveform-player-controls-peakdata"></canvas>\n    <div class="waveform-player-controls-current-time">0:13</div>\n    <div class="waveform-player-controls-total-time">1:03</div>\n  </div>\n  <span class="waveform-player-upper-unplayed"></span>\n  <span class="waveform-player-lower-unplayed"></span>\n  <span class="waveform-player-upper-played"></span>\n  <span class="waveform-player-lower-played"></span>\n  <span class="waveform-player-mouseover-upper-played"></span>\n  <span class="waveform-player-mouseover-lower-played"></span>\n</div>\n<div class="waveform-player-show-more"></div>\n';i.ASCII_PEAK_DATA_MAP="!#$%()*+,-./0123456789:;=?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~";var c=function(){function e(e){var t=this;if(this.wrapper=e,this._tracks=[],this._trackByAudioSrc={},this._isPlaying=!1,this._hasHadInteraction=!1,a()){var i=document.location.href.match(/\bplayerMode=(\w+)(&|$)/);if(i&&(this._specialMode=i[1]),this._specialMode!==h&&(this._tracks=this._parseTracks(),this._tracks&&0!==this._tracks.length)){e.addEventListener("click",function(e){return t._handleClick(e)},!0),e.addEventListener("mouseover",function(e){return t._handleMouseoverOut(e)},!0),e.addEventListener("mouseout",function(e){return t._handleMouseoverOut(e)},!0);var r=document.createElement("div");for(r.innerHTML=u.trim(),this._controlsDiv=r.firstChild;r.childNodes.length>0;)e.insertBefore(r.lastChild,e.firstChild);this._prevButton=this._controlsDiv.getElementsByClassName("waveform-player-controls-prev")[0],this._nextButton=this._controlsDiv.getElementsByClassName("waveform-player-controls-next")[0],this._currentTimeDiv=this._controlsDiv.getElementsByClassName("waveform-player-controls-current-time")[0],this._totalTimeDiv=this._controlsDiv.getElementsByClassName("waveform-player-controls-total-time")[0],this._upperUnplayedTest=this._controlsDiv.getElementsByClassName("waveform-player-upper-unplayed")[0],this._lowerUnplayedTest=this._controlsDiv.getElementsByClassName("waveform-player-lower-unplayed")[0],this._upperPlayedTest=this._controlsDiv.getElementsByClassName("waveform-player-upper-played")[0],this._lowerPlayedTest=this._controlsDiv.getElementsByClassName("waveform-player-lower-played")[0],this._mouseoverUpperPlayedTest=this._controlsDiv.getElementsByClassName("waveform-player-mouseover-upper-played")[0],this._mouseoverLowerPlayedTest=this._controlsDiv.getElementsByClassName("waveform-player-mouseover-lower-played")[0],this._waveform=new o.WaveformRenderer(this._controlsDiv.getElementsByClassName("waveform-player-controls-peakdata")[0]),this._waveform.onpositionselect=this._onWaveformPositionSelect.bind(this),this._currentTrack=this._tracks[0],this._currentTrack.setActive(!0),this._waveform.setPeakData(this._currentTrack.peakData),this._updateColoursFromCSS(),this._handlePlayingStateChange(),this._handleTrackTimeUpdate(),setTimeout(this._handleExternalStyleChange.bind(this),10),setTimeout(this._handleExternalStyleChange.bind(this),50),setTimeout(this._handleExternalStyleChange.bind(this),100),setTimeout(this._handleExternalStyleChange.bind(this),250),setTimeout(this._handleExternalStyleChange.bind(this),500),setTimeout(this._handleExternalStyleChange.bind(this),1e3),setTimeout(this._handleExternalStyleChange.bind(this),2e3),setTimeout(this._handleExternalStyleChange.bind(this),4e3),setTimeout(this._handleExternalStyleChange.bind(this),8e3),setTimeout(this._handleExternalStyleChange.bind(this),16e3)}}}return e.prototype.setPlaying=function(e){this._isPlaying!==e&&this._togglePlay()},e.prototype._updateColoursFromCSS=function(){function e(e){var t=getComputedStyle(e);return t?t.color:""}this._waveform.setColours({upperUnplayed:e(this._upperUnplayedTest),lowerUnplayed:e(this._lowerUnplayedTest),upperPlayed:e(this._upperPlayedTest),lowerPlayed:e(this._lowerPlayedTest),mouseoverUpperPlayed:e(this._mouseoverUpperPlayedTest),mouseoverLowerPlayed:e(this._mouseoverLowerPlayedTest)})},e.prototype._handlePlayingStateChange=function(){var e=this._currentTrack.isPlaying;this._isPlaying!==e&&(this._isPlaying=e,e?(this._resizeIfRequiredInterval=setInterval(this._handleExternalStyleChange.bind(this),1e3),this.onplay&&this.onplay(this)):clearInterval(this._resizeIfRequiredInterval)),this._handleExternalStyleChange(),this._prevButton.disabled=this._currentTrack===this._tracks[0],this._nextButton.disabled=this._currentTrack===this._tracks[this._tracks.length-1],this._prevButton.style.visibility=this._nextButton.style.visibility=this._tracks.length<2?"hidden":""},e.prototype._updateClass=function(){var e=this._currentTrack.isPlaying,t="waveform-player waveform-player-enabled";e&&(t+=" waveform-player-playing"),this._currentTrack.isBuffering&&(t+=" waveform-player-buffering"),this._hasHadInteraction?e&&(t+=" waveform-player-interacted"):this._currentTrack.description.scrollHeight>this._listUl.clientHeight&&(t+=" waveform-player-description-truncated"),this.wrapper.className=t},e.prototype._handleClick=function(e){this._hasHadInteraction=!0;for(var t=e.target;t&&"A"!==t.nodeName&&"BUTTON"!==t.nodeName;)t=t.parentNode;var i=!(e.screenX||e.screenY);if(t instanceof HTMLAnchorElement){i||t.blur();var r=this._trackByAudioSrc[t.href];if(r){e.preventDefault(),this._selectTrack(r);var a=t.getAttribute("data-start-time");return void this._currentTrack.setCurrentTime(parseFloat(a)||0)}}if(t instanceof HTMLButtonElement)switch(i||t.blur(),t.className){case"waveform-player-controls-toggleplay":return void this._togglePlay();case"waveform-player-controls-next":return void this._selectRelativeTrack(1);case"waveform-player-controls-prev":return void this._selectRelativeTrack(-1);default:console.error('Unrecognised button class: "'+t.className+'"')}this._handlePlayingStateChange()},e.prototype._handleMouseoverOut=function(e){var t=e.target;if(t instanceof HTMLAnchorElement&&"waveform-player-subsection-play"===t.className&&t.href===this._currentTrack.audioSrc){var i=parseFloat(t.getAttribute("data-start-time"));isNaN(i)||("mouseover"===e.type?this._waveform.setHighlightPosition(i,this._currentTrack.totalTime):this._waveform.clearHighlightPosition())}},e.prototype.destroy=function(){this._waveform&&this._waveform.destroy()},e.prototype._handleExternalStyleChange=function(){for(var e=0,t=this._tracks;e<t.length;e++)t[e].update();this._updateColoursFromCSS(),this._updateClass()},e.prototype._selectTrack=function(e,t){if(this._currentTrack!==e){this._currentTrack=e,this._waveform.setPeakData(this._currentTrack.peakData);for(var i=0,r=this._tracks;i<r.length;i++){var a=r[i];a===e?(a.setRelativePosition(0),a.setPlaying(!0,!0),a.setActive(!0)):(a.setPlaying(!1,!0),a.setActive(!1))}}else this._currentTrack.setPlaying(!0);this._handleTrackTimeUpdate(),this._handlePlayingStateChange()},e.prototype._selectRelativeTrack=function(e){var t=this._tracks.indexOf(this._currentTrack)+e;this._tracks[t]&&this._selectTrack(this._tracks[t])},e.prototype._togglePlay=function(){this._currentTrack.isPlaying?(this._currentTrack.setPlaying(!1),this._handleTrackTimeUpdate(),this._handlePlayingStateChange()):(this._currentTrack.restart(),this._selectTrack(this._currentTrack))},e.prototype._parseTracks=function(){var e=this,t=this.wrapper.firstElementChild;if(!(t instanceof HTMLUListElement))return console.error(".waveform-player with no ul child"),null;this._listUl=t,this._listUl.className="waveform-player-track-list";for(var i=[],a=0;a<this._listUl.childNodes.length;a++)if("LI"===this._listUl.childNodes[a].nodeName){for(var s=this._listUl.childNodes[a],o=void 0,l=void 0,h=0,u=0;u<s.childNodes.length;u++){var c=s.childNodes[u];if(c.nodeType===Node.TEXT_NODE){if(""!==c.nodeValue.trim())return console.error("Illegal text child of track list <li> item, expected one <a> element then one <div> element",c),null}else if(c.nodeType===Node.ELEMENT_NODE){if(0===h){if(!(c instanceof HTMLAnchorElement))return console.error("Illegal child of track list <li> item, element "+(u+1)+" to be a <a> but it was a <"+c.nodeName.toLowerCase()+">",c),null;o=c}else{if(1!==h)return console.error("Illegal child of track list <li> item, expected only 2 child elements but found element "+(u+1)+" which is a <"+c.nodeName.toLowerCase()+">",c),null;if(!(c instanceof HTMLDivElement))return console.error("Illegal child of track list <li> item, element index "+(u+1)+" to be a <div> but it was a <"+c.nodeName.toLowerCase()+">",c),null;l=c}++h}}if(!o)return console.error("Track list <li> item gas no link child"),null;o.className="waveform-player-track-list-link";var d=o.getAttribute("data-peaks");null!==d&&""!==d||(console.error('<a href="'+o.href+'"> track has no data-peaks attribute.'),d="0");var p=r(d,o.href);l||(l=document.createElement("div"),s.appendChild(l)),l.style.visibility="hidden",l.className="waveform-player-track-list-item-description";var _=this._parseDescriptionSubsections(l,o.href),m=new n.Track(o.href,s,l,p,_);m.ontimeupdate=this._handleTrackTimeUpdate.bind(this),m.onended=this._handleTrackEnded.bind(this),m.onbufferingchange=this._handleTrackBufferingChange.bind(this),i.push(m),this._trackByAudioSrc[o.href]&&console.error('More than one track has the url "'+o.href+'"'),this._trackByAudioSrc[o.href]=m}return requestAnimationFrame(function(){for(var t=e.wrapper.getElementsByClassName("waveform-player-track-list-item-description"),i=0;i<t.length;i++)t[i].style.visibility=""}),i},e.prototype._parseDescriptionSubsections=function(e,t){function i(e){if(!e)return null;var t=e.split(":"),i=t[0],r=t[1];return 60*parseFloat(i)+parseFloat(r)}for(var r,a=[],n=e.getElementsByClassName("subsection"),s=0;s<n.length;s++){var o=n[s],l=o.textContent.trim().replace(/\s+/g," "),h=l.match(/^(\d:\d\d(?:\.\d+)?)\s*(?:(?:-|to)\s*(\d:\d\d(?:\.\d+)?))?\s*(?::|-)?\s*(.*)/i);if(h){var u=document.createElement("a");for(u.href=t,u.className="waveform-player-subsection-play";o.childNodes.length>0;)u.appendChild(o.firstChild);o.appendChild(u);var c={startTime:i(h[1]),endTime:i(h[2]),title:h[3],element:o};u.setAttribute("data-start-time",String(c.startTime)),a.push(c),r&&null===r.endTime&&(r.endTime=c.startTime),r=c}else console.error('Subsection doesn\'t have correct text format "1:23 - title" or "1:23 to 4:56 - title": "'+l+'"')}return a},e.prototype._onWaveformPositionSelect=function(e){this._currentTrack.setRelativePosition(e),this._currentTrack.setPlaying(!0),this._handlePlayingStateChange()},e.prototype._handleTrackTimeUpdate=function(e){function t(e){if(isNaN(e))return"...";var t=Math.floor(e/60),i=String(Math.round(e-60*t));return 1===i.length&&(i="0"+i),t+":"+i}if(void 0===e&&(e=this._currentTrack),e===this._currentTrack)if(this._currentTrack.isBuffering?this._currentTimeDiv.innerHTML="loading...":this._currentTimeDiv.innerHTML=t(this._currentTrack.currentTime),isNaN(this._currentTrack.totalTime))this._totalTimeDiv.style.opacity="0";else{this._totalTimeDiv.style.opacity="1",this._totalTimeDiv.innerHTML=t(this._currentTrack.totalTime);var i=this._currentTrack.isPlaying?1:0;this._waveform.setPlayheadPosition(this._currentTrack.currentTime,this._currentTrack.totalTime,i)}},e.prototype._handleTrackBufferingChange=function(e){e===this._currentTrack&&(this._handleTrackTimeUpdate(e),this._handlePlayingStateChange())},e.prototype._handleTrackEnded=function(e){this._currentTrack===e&&this._selectRelativeTrack(1)},e}();i.Player=c},{"./Track":3,"./WaveformRenderer":4,"./shared":6,"base64-js":1}],3:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=null,a=null,n="AudioContext"in window||"webkitAudioContext"in window,s=function(){function e(e,t,i,r,a){var s=this;this.audioSrc=e,this._listItem=t,this._description=i,this.peakData=r,this.subsections=a,this._playing=!1,this._waitingForAudioStart=!1,this._active=!1,this._resumeTime=0,this._buffering=!1,this._playingLastBufferCheck=!1,this._frequencyDomainData=null,this.ontimeupdate=null,this.onended=null,this.onbufferingchange=null,this._handleTimeUpdate=function(){s._updateSubsectionDisplay(),s._audio.currentTime>0&&(s._waitingForAudioStart=!1),s.ontimeupdate&&s.ontimeupdate(s)},this._handleEnded=function(){s.onended&&s.onended(s)},this._handleStoppedDueToError=function(){s._waitingForAudioStart=!0},this._checkPlayState=function(){var e=s._playing&&s._playingLastBufferCheck&&s.currentTime===s._timeLastBufferCheck&&!s._audio.ended;s._buffering!==e&&(s._buffering=e,s.onbufferingchange&&s.onbufferingchange(s)),s._playingLastBufferCheck=s._playing,s._timeLastBufferCheck=s.currentTime},this._nextFFTRenderScheduled=!1,this._metaSrc=e.replace(/\.\w+$/,".meta"),this._audio=document.createElement("audio"),this._audio.preload="metadata",this._audio.src=e,this._audio.addEventListener("timeupdate",this._handleTimeUpdate),this._audio.addEventListener("loadedmetadata",this._handleTimeUpdate),this._audio.addEventListener("end",this._handleEnded),this._audio.addEventListener("error",this._handleStoppedDueToError),this._audio.addEventListener("stalled",this._handleStoppedDueToError),a.sort(function(e,t){return e.startTime-t.startTime}),this._updateClass(),this._updateSubsectionDisplay(),n&&(this._setupAudioContext(),this._fftCanvas=document.createElement("canvas"),this._fftCanvas.className="waveform-player-track-fft-canvas",this._listItem.firstElementChild.appendChild(this._fftCanvas),this._fftContext=this._fftCanvas.getContext("2d"))}return e.prototype.setPlaying=function(e,t){t&&(this._resumeTime=0),e?(this._waitingForAudioStart=!0,this._audio.currentTime=this._resumeTime||0,this._audio.play()):(this._resumeTime=this._audio.currentTime,this._waitingForAudioStart&&(this._audio.src=this._audio.src)),e!==this._playing&&(this._playing=e,e?(n&&(this._audioSource.connect(a),this._audioSource.connect(r.destination),this._startFFTRenderLoop()),this._playStateDetectionInterval=setInterval(this._checkPlayState,1e3),this._checkPlayState()):(this._audio.pause(),clearInterval(this._playStateDetectionInterval),this._checkPlayState()),this._updateClass())},e.prototype.setActive=function(e){e!==this._active&&(this._active=e,this._updateClass())},e.prototype.setRelativePosition=function(e){this._resumeTime=this._audio.duration*e||0,this._audio.play(),this._audio.currentTime=this._resumeTime},e.prototype.setCurrentTime=function(e){this._audio.currentTime=e||0},e.prototype.restart=function(){this._audio.currentTime=0},e.prototype.update=function(){this._updateDescriptionMaxHeight()},Object.defineProperty(e.prototype,"isPlaying",{get:function(){return this._playing},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBuffering",{get:function(){return this._buffering},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._audio.currentTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalTime",{get:function(){return this._audio.duration},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){return this._description},enumerable:!0,configurable:!0}),e.prototype._updateDescriptionMaxHeight=function(){var e=0;this._playing&&(e=this._description.scrollHeight),this._descriptionMaxHeight!==e&&(this._descriptionMaxHeight=e,this._description.style.maxHeight=e+"px")},e.prototype._updateSubsectionDisplay=function(){for(var e=null,t=0,i=this.subsections;t<i.length;t++){var r=i[t];null===e&&r.startTime<=this.currentTime&&(!r.endTime||r.endTime>this.currentTime)?(e=r).element.className="waveform-player-subsection waveform-player-active-subsection":r.element.className="waveform-player-subsection"}},e.prototype._updateClass=function(){var e="waveform-player-track-list-item";this._active&&(e+=" waveform-player-track-list-item-active"),this._playing&&(e+=" waveform-player-track-list-item-playing"),this._listItem.className=e,this._updateDescriptionMaxHeight()},e.prototype._setupAudioContext=function(){null===r&&(r=new(window.AudioContext||window.webkitAudioContext),(a=r.createAnalyser()).minDecibels=-70,a.maxDecibels=-20,a.smoothingTimeConstant=.5),this._audioSource=r.createMediaElementSource(this._audio)},e.prototype._startFFTRenderLoop=function(){var e=this,t=function(){e._renderFFT(),e._playing&&!e._nextFFTRenderScheduled&&(e._nextFFTRenderScheduled=!0,requestAnimationFrame(t))};t()},e.prototype._renderFFT=function(){this._nextFFTRenderScheduled=!1;var e=this._fftCanvas.offsetWidth,t=this._fftCanvas.offsetHeight;this._fftCanvas.width===e&&this._fftCanvas.height===t||(this._fftCanvas.width=e,this._fftCanvas.height=t);var i=this._fftContext;if(i.clearRect(0,0,e,t),this._playing){this._frequencyDomainData||(this._frequencyDomainData=new Uint8Array(a.frequencyBinCount)),a.getByteFrequencyData(this._frequencyDomainData);for(var r=[],n=1,s=0;;){for(var o=0,l=0;l<n;l++)o+=this._frequencyDomainData[s++];if(s>this._frequencyDomainData.length)break;r.push(o/n/255),n*=1.3}i.fillStyle="rgba(255, 255, 255, 0.1)";for(var h=e/r.length,u=0;u<r.length;u++)i.fillRect(h*u,t,.9*h,-r[u]*t),n*=1.3}},e}();i.Track=s},{}],4:[function(e,t,i){"use strict";function r(e){if(e<.5)return e*e*2;var t=1-e;return 1-t*t*2}function a(e,t,i,a){var n=t/i*(1-1/a);return r(Math.min(1,Math.max(0,(e-n)*a)))}function n(e,t){if(e.length===t.length)for(a=0;a<e.length;a++)t[a]=e[a];else if(e.length>t.length)for(var i=(h=e.length/t.length)/2,r=i,a=0;a<t.length;a++){var n=Math.floor(r-i),s=Math.min(Math.ceil(r+i),e.length);r+=h;for(var o=0,l=n;l<s;l++)o=Math.max(o,e[l]);t[a]=o}else for(var h=(e.length-1)/t.length,a=0;a<t.length;a++){var r=a*h,u=Math.floor(r),c=r-u,d=Math.max(u,0),p=Math.min(u+1,e.length-1),_=(1-c)*e[d]+c*e[p];t[a]=_}}Object.defineProperty(i,"__esModule",{value:!0});var s=e("./shared"),o=function(){function e(e){this._canvas=e,this._rawCurrentPeaks=[0],this._rawPreviousPeaks=[0],this._resampledCurrentPeaks=[0],this._resampledPreviousPeaks=[0],this._transitioningPeaks=[0],this._peakDataTransitionStartTime=0,this._transitionProgress=1,this._previousTransitionProgress=1,this._previousPlayheadPosition=0,this._renderLoopRunning=!1,this._nextRenderIsScheduled=!1,this._playheadPosition=0,this._playheadSmoothing=!1,this._playheadSmoothingStartTime=0,this._playheadSmoothingDuration=0,this._playheadSmoothingPlayLength=0,this._hasCurrentInteraction=!1,this._mousePosition=0,this._highlightPosition=0,this._colours={upperUnplayed:"#DDD",lowerUnplayed:"#FFF",upperPlayed:"#AAA",lowerPlayed:"#CCC",mouseoverUpperPlayed:"#888",mouseoverLowerPlayed:"#AAA"},this._handleWindowResizeDelegate=this._handleWindowResize.bind(this),this._ctx=e.getContext("2d"),this._render(),window.addEventListener("resize",this._handleWindowResizeDelegate),this._setupInteractionHandlers()}return e.prototype.destroy=function(){window.removeEventListener("resize",this._handleWindowResizeDelegate)},e.prototype.setPeakData=function(e){1===this._transitionProgress?(this._previousPlayheadPosition=this._getSmoothedPlayheadPosition(),this._playheadPosition=0,this._playheadSmoothing=!1,this._rawPreviousPeaks=this._rawCurrentPeaks,this._resampledPreviousPeaks=this._resampledCurrentPeaks,this._rawCurrentPeaks=e,this._resampledCurrentPeaks=null,this._peakDataTransitionStartTime=Date.now(),this._startRenderLoop()):this._rawQueuedPeakData=e},e.prototype.setPlayheadPosition=function(e,t,i){void 0===i&&(i=0),this._playheadPosition=e/t,i?(this._playheadSmoothing=!0,this._playheadSmoothingStartTime=Date.now(),this._playheadSmoothingPlayLength=t,this._playheadSmoothingDuration=i):this._playheadSmoothing=!1,this._startRenderLoop()},e.prototype.setHighlightPosition=function(e,t){this._highlightPosition=e/t,this._startRenderLoop()},e.prototype.clearHighlightPosition=function(){this._highlightPosition=0,this._startRenderLoop()},e.prototype.setColours=function(e){this._colours=e},e.prototype._startRenderLoop=function(){this._renderLoopRunning||(this._renderLoopRunning=!0,this._render())},e.prototype._render=function(){this._nextRenderIsScheduled=!1;var e=Math.ceil(this._canvas.offsetWidth*(window.devicePixelRatio||1)),t=Math.ceil(this._canvas.offsetHeight*(window.devicePixelRatio||1)),i=this._resizeCanvas(e,t);this._transitionProgress=Math.min(1,(Date.now()-this._peakDataTransitionStartTime)/1e3/.6),(this._transitionProgress<1||this._previousTransitionProgress<1||i||this._rawLastRenderedPeaks!==this._rawCurrentPeaks)&&this._redrawPeakShape(e,t),this._redrawColors(e,t),this._transitionProgress>=1&&(this._rawQueuedPeakData?(this.setPeakData(this._rawQueuedPeakData),this._rawQueuedPeakData=null):this._renderLoopRunning=this._playheadSmoothingIsActive),this._previousTransitionProgress=this._transitionProgress,this._renderLoopRunning&&!this._nextRenderIsScheduled&&(this._nextRenderIsScheduled=!0,requestAnimationFrame(this._render.bind(this)))},e.prototype._resizeCanvas=function(e,t){e=Math.min(e,1e4),t=Math.min(t,1e4);var i=!1;return this._canvas.width===e&&this._canvas.height===t||(this._canvas.width=e,this._canvas.height=t,i=!0,this._resampledCurrentPeaks=null,this._resampledPreviousPeaks=null),this._resampledCurrentPeaks||(this._resampledCurrentPeaks=s.makeNumberArray(e/1),n(this._rawCurrentPeaks,this._resampledCurrentPeaks)),this._resampledPreviousPeaks||(this._resampledPreviousPeaks=s.makeNumberArray(e/1),n(this._rawPreviousPeaks,this._resampledPreviousPeaks)),i},e.prototype._getSmoothedPlayheadPosition=function(){var e=this._playheadPosition;if(this._playheadSmoothingIsActive=!1,this._playheadSmoothing){var t=(Date.now()-this._playheadSmoothingStartTime)/1e3;t<this._playheadSmoothingDuration&&(this._playheadSmoothingIsActive=!0),e+=t/this._playheadSmoothingPlayLength}return Math.min(1,Math.max(0,e))},e.prototype._redrawPeakShape=function(e,t){this._updateTransitioningPeaks();var i=this._transitioningPeaks,r=i.length,a=Math.ceil(t/2)+1,n=a-2,s=this._ctx;s.clearRect(0,0,e,t),s.beginPath(),s.moveTo(0,a);for(var o=e/i.length,l=0;l<r;l++)s.lineTo(l*o,n-i[l]*n);s.lineTo(e,a),s.closePath(),s.fillStyle="#FF0088",s.fill(),s.save(),s.translate(0,Math.round(t/2)),s.scale(1,-1),this._ctx.drawImage(this._canvas,0,-Math.round(t/2),e,t),s.restore(),this._rawLastRenderedPeaks=this._rawCurrentPeaks},e.prototype._redrawColors=function(e,t){function i(i,a,n,s){void 0===s&&(s=0);var o=r.createLinearGradient(0,0,0,t);o.addColorStop(0,i),o.addColorStop(1,a),r.fillStyle=o,r.fillRect(e*n,0,e*(s-n),t)}var r=this._ctx;r.globalCompositeOperation="source-atop";var a=this._getSmoothedPlayheadPosition();i(this._colours.upperUnplayed,this._colours.lowerUnplayed,1),i(this._colours.upperPlayed,this._colours.lowerPlayed,a),this._previousPlayheadPosition>a&&this._transitionProgress,this._hasCurrentInteraction?i(this._colours.mouseoverUpperPlayed,this._colours.mouseoverLowerPlayed,this._mousePosition,a):this._highlightPosition&&i(this._colours.mouseoverUpperPlayed,this._colours.mouseoverLowerPlayed,this._highlightPosition,a),r.globalCompositeOperation="source-over"},e.prototype._setupInteractionHandlers=function(){var e=this,t=function(t,i,r,a){t.preventDefault(),e._hasCurrentInteraction=i;var n=e._canvas.getBoundingClientRect();a&&(e._mousePosition=(a.pageX-n.left)/n.width),e._startRenderLoop(),r&&e.onpositionselect&&e.onpositionselect(e._mousePosition)};this._canvas.addEventListener("mouseover",function(e){return t(e,!0,!1,e)}),this._canvas.addEventListener("mousemove",function(e){return t(e,!0,!1,e)}),this._canvas.addEventListener("mouseout",function(e){return t(e,!1,!1,e)}),this._canvas.addEventListener("mouseup",function(e){return t(e,!0,!0,e)}),this._canvas.addEventListener("touchstart",function(e){return t(e,!0,!1,e.targetTouches[0])}),this._canvas.addEventListener("touchmove",function(e){return t(e,!0,!1,e.targetTouches[0])}),this._canvas.addEventListener("touchend",function(e){return t(e,!1,!0,e.targetTouches[0])})},e.prototype._handleWindowResize=function(){!document.body||this._canvas.compareDocumentPosition(document.body)&Node.DOCUMENT_POSITION_DISCONNECTED||this._startRenderLoop()},e.prototype._updateTransitioningPeaks=function(){this._transitioningPeaks.length!==this._resampledCurrentPeaks.length&&(this._transitioningPeaks=s.makeNumberArray(this._resampledCurrentPeaks.length));for(var e=this._resampledPreviousPeaks,t=this._resampledCurrentPeaks,i=this._transitioningPeaks,n=t.length,o=2*Math.PI*5,l=0;l<n;l++){var h=a(this._transitionProgress,l,n,2),u=r(1-Math.abs(2*h-1)),c=this._resampledPreviousPeaks[l]+(t[l]-e[l])*r(h);c+=Math.sin(l/n*o)*u*.35,i[l]=Math.max(0,Math.min(1,c))}},e}();i.WaveformRenderer=o},{"./shared":6}],5:[function(e,t,i){"use strict";function r(){for(var e=document.getElementsByClassName(o),t={},i=0;i<e.length;i++){var r=e[i];if(r instanceof HTMLDivElement){if(r.hasAttribute("data-disable-waveform-player"))continue;if(null===(u=r.getAttribute("data-waveform-player-id"))){u=String(++l);var n=new s.Player(r);n.onplay=a,h[u]=n,r.setAttribute("data-waveform-player-id",u)}t[u]=!0}else console.error(o+" class attribute is only supported on div elements!")}for(var u in h)t[u]||(h[u].destroy(),delete h[u])}function a(e){for(var t in h)h[t]!==e&&h[t].setPlaying(!1)}function n(){u||"loading"===document.readyState||(u=!0,r())}Object.defineProperty(i,"__esModule",{value:!0});var s=e("./Player"),o="waveform-player",l=0,h={};i.initialiseWaveformPlayers=r,window.initialiseWaveformPlayers=r;var u=!1;document.addEventListener("readystatechange",n),n()},{"./Player":2}],6:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.makeNumberArray=function(e){return"Float32Array"in window?new Float32Array(e):new Array(e)}},{}]},{},[5]);