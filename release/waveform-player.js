!function(){return function e(t,i,r){function a(s,o){if(!i[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(n)return n(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var u=i[s]={exports:{}};t[s][0].call(u.exports,function(e){return a(t[s][1][e]||e)},u,u.exports,e,t,i,r)}return i[s].exports}for(var n="function"==typeof require&&require,s=0;s<r.length;s++)a(r[s]);return a}}()({1:[function(e,t,i){"use strict";i.byteLength=function(e){var t=h(e),i=t[0],r=t[1];return 3*(i+r)/4-r},i.toByteArray=function(e){var t,i,r=h(e),s=r[0],o=r[1],l=new n(function(e,t,i){return 3*(t+i)/4-i}(0,s,o)),u=0,d=o>0?s-4:s;for(i=0;i<d;i+=4)t=a[e.charCodeAt(i)]<<18|a[e.charCodeAt(i+1)]<<12|a[e.charCodeAt(i+2)]<<6|a[e.charCodeAt(i+3)],l[u++]=t>>16&255,l[u++]=t>>8&255,l[u++]=255&t;2===o&&(t=a[e.charCodeAt(i)]<<2|a[e.charCodeAt(i+1)]>>4,l[u++]=255&t);1===o&&(t=a[e.charCodeAt(i)]<<10|a[e.charCodeAt(i+1)]<<4|a[e.charCodeAt(i+2)]>>2,l[u++]=t>>8&255,l[u++]=255&t);return l},i.fromByteArray=function(e){for(var t,i=e.length,a=i%3,n=[],s=0,o=i-a;s<o;s+=16383)n.push(u(e,s,s+16383>o?o:s+16383));1===a?(t=e[i-1],n.push(r[t>>2]+r[t<<4&63]+"==")):2===a&&(t=(e[i-2]<<8)+e[i-1],n.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return n.join("")};for(var r=[],a=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,l=s.length;o<l;++o)r[o]=s[o],a[s.charCodeAt(o)]=o;function h(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=e.indexOf("=");return-1===i&&(i=t),[i,i===t?0:4-i%4]}function u(e,t,i){for(var a,n,s=[],o=t;o<i;o+=3)a=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),s.push(r[(n=a)>>18&63]+r[n>>12&63]+r[n>>6&63]+r[63&n]);return s.join("")}a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63},{}],2:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=e("./Track"),a=e("./shared"),n=e("./WaveformRenderer"),s=e("base64-js"),o="disable",l='\n<div class="waveform-player-controls">\n  <button class="waveform-player-controls-toggleplay">toggle play</button>\n  <button class="waveform-player-controls-prev">prev</button>\n  <button class="waveform-player-controls-next">next</button>\n  <div class="waveform-player-controls-peakdata-wrapper">\n    <canvas class="waveform-player-controls-peakdata"></canvas>\n    <div class="waveform-player-controls-current-time">0:13</div>\n    <div class="waveform-player-controls-total-time">1:03</div>\n  </div>\n  <span class="waveform-player-upper-unplayed"></span>\n  <span class="waveform-player-lower-unplayed"></span>\n  <span class="waveform-player-upper-played"></span>\n  <span class="waveform-player-lower-played"></span>\n  <span class="waveform-player-mouseover-upper-played"></span>\n  <span class="waveform-player-mouseover-lower-played"></span>\n</div>\n<div class="waveform-player-show-more"></div>\n';i.ASCII_PEAK_DATA_MAP="!#$%()*+,-./0123456789:;=?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~";var h=function(){function e(e){var t=this;if(this.wrapper=e,this._tracks=[],this._trackByAudioSrc={},this._isPlaying=!1,this._hasHadInteraction=!1,function(){var e,t=window;if(!t.HTMLAudioElement||!t.HTMLCanvasElement)return!1;"transform"in document.createElement("div").style?"getComputedStyle"in window?Array.prototype.indexOf?window.requestAnimationFrame?Date.now||(e="Date.now"):e="requestAnimationFrame":e="Array.indexOf":e="getComputedStyle":e="CSS transform";if(e)return console.error("Unnecessary restriction: this browser support audio and canvas but not "+e+". User agent: "+navigator.userAgent),!1;return!0}()){var i=document.location.href.match(/\bplayerMode=(\w+)(&|$)/);if(i&&(this._specialMode=i[1]),this._specialMode!==o&&(this._tracks=this._parseTracks(),this._tracks&&0!==this._tracks.length)){e.addEventListener("click",function(e){return t._handleClick(e)},!0),e.addEventListener("mouseover",function(e){return t._handleMouseoverOut(e)},!0),e.addEventListener("mouseout",function(e){return t._handleMouseoverOut(e)},!0);var r=document.createElement("div");for(r.innerHTML=l.trim(),this._controlsDiv=r.firstChild;r.childNodes.length>0;)e.insertBefore(r.lastChild,e.firstChild);this._prevButton=this._controlsDiv.getElementsByClassName("waveform-player-controls-prev")[0],this._nextButton=this._controlsDiv.getElementsByClassName("waveform-player-controls-next")[0],this._currentTimeDiv=this._controlsDiv.getElementsByClassName("waveform-player-controls-current-time")[0],this._totalTimeDiv=this._controlsDiv.getElementsByClassName("waveform-player-controls-total-time")[0],this._upperUnplayedTest=this._controlsDiv.getElementsByClassName("waveform-player-upper-unplayed")[0],this._lowerUnplayedTest=this._controlsDiv.getElementsByClassName("waveform-player-lower-unplayed")[0],this._upperPlayedTest=this._controlsDiv.getElementsByClassName("waveform-player-upper-played")[0],this._lowerPlayedTest=this._controlsDiv.getElementsByClassName("waveform-player-lower-played")[0],this._mouseoverUpperPlayedTest=this._controlsDiv.getElementsByClassName("waveform-player-mouseover-upper-played")[0],this._mouseoverLowerPlayedTest=this._controlsDiv.getElementsByClassName("waveform-player-mouseover-lower-played")[0],this._waveform=new n.WaveformRenderer(this._controlsDiv.getElementsByClassName("waveform-player-controls-peakdata")[0]),this._waveform.onpositionselect=this._onWaveformPositionSelect.bind(this),this._currentTrack=this._tracks[0],this._currentTrack.setActive(!0),this._waveform.setPeakData(this._currentTrack.peakData),this._updateColoursFromCSS(),this._handlePlayingStateChange(),this._handleTrackTimeUpdate(),setTimeout(this._handleExternalStyleChange.bind(this),10),setTimeout(this._handleExternalStyleChange.bind(this),50),setTimeout(this._handleExternalStyleChange.bind(this),100),setTimeout(this._handleExternalStyleChange.bind(this),250),setTimeout(this._handleExternalStyleChange.bind(this),500),setTimeout(this._handleExternalStyleChange.bind(this),1e3),setTimeout(this._handleExternalStyleChange.bind(this),2e3),setTimeout(this._handleExternalStyleChange.bind(this),4e3),setTimeout(this._handleExternalStyleChange.bind(this),8e3),setTimeout(this._handleExternalStyleChange.bind(this),16e3)}}}return e.prototype.setPlaying=function(e){this._isPlaying!==e&&this._togglePlay()},e.prototype._updateColoursFromCSS=function(){function e(e){var t=getComputedStyle(e);return t?t.color:""}this._waveform.setColours({upperUnplayed:e(this._upperUnplayedTest),lowerUnplayed:e(this._lowerUnplayedTest),upperPlayed:e(this._upperPlayedTest),lowerPlayed:e(this._lowerPlayedTest),mouseoverUpperPlayed:e(this._mouseoverUpperPlayedTest),mouseoverLowerPlayed:e(this._mouseoverLowerPlayedTest)})},e.prototype._handlePlayingStateChange=function(){var e=this._currentTrack.isPlaying;this._isPlaying!==e&&(this._isPlaying=e,e?(this._resizeIfRequiredInterval=setInterval(this._handleExternalStyleChange.bind(this),1e3),this.onplay&&this.onplay(this)):clearInterval(this._resizeIfRequiredInterval)),this._handleExternalStyleChange(),this._prevButton.disabled=this._currentTrack===this._tracks[0],this._nextButton.disabled=this._currentTrack===this._tracks[this._tracks.length-1],this._prevButton.style.visibility=this._nextButton.style.visibility=this._tracks.length<2?"hidden":""},e.prototype._updateClass=function(){var e=this._currentTrack.isPlaying,t="waveform-player waveform-player-enabled";e&&(t+=" waveform-player-playing"),this._currentTrack.isBuffering&&(t+=" waveform-player-buffering"),this._hasHadInteraction?e&&(t+=" waveform-player-interacted"):this._currentTrack.description.scrollHeight>this._listUl.clientHeight&&(t+=" waveform-player-description-truncated"),this.wrapper.className=t},e.prototype._handleClick=function(e){this._hasHadInteraction=!0;for(var t=e.target;t&&"A"!==t.nodeName&&"BUTTON"!==t.nodeName;)t=t.parentNode;var i=!(e.screenX||e.screenY);if(t instanceof HTMLAnchorElement){i||t.blur();var r=this._trackByAudioSrc[t.href];if(r){e.preventDefault(),this._selectTrack(r);var a=t.getAttribute("data-start-time");return void this._currentTrack.setCurrentTime(parseFloat(a)||0)}}if(t instanceof HTMLButtonElement)switch(i||t.blur(),t.className){case"waveform-player-controls-toggleplay":return void this._togglePlay();case"waveform-player-controls-next":return void this._selectRelativeTrack(1);case"waveform-player-controls-prev":return void this._selectRelativeTrack(-1);default:console.error('Unrecognised button class: "'+t.className+'"')}this._handlePlayingStateChange()},e.prototype._handleMouseoverOut=function(e){var t=e.target;if(t instanceof HTMLAnchorElement&&"waveform-player-subsection-play"===t.className&&t.href===this._currentTrack.audioSrc){var i=parseFloat(t.getAttribute("data-start-time"));isNaN(i)||("mouseover"===e.type?this._waveform.setHighlightPosition(i,this._currentTrack.totalTime):this._waveform.clearHighlightPosition())}},e.prototype.destroy=function(){this._waveform&&this._waveform.destroy()},e.prototype._handleExternalStyleChange=function(){for(var e=0,t=this._tracks;e<t.length;e++){t[e].update()}this._updateColoursFromCSS(),this._updateClass()},e.prototype._selectTrack=function(e,t){if(this._currentTrack!==e){this._currentTrack=e,this._waveform.setPeakData(this._currentTrack.peakData);for(var i=0,r=this._tracks;i<r.length;i++){var a=r[i];a===e?(a.setRelativePosition(0),a.setPlaying(!0,!0),a.setActive(!0)):(a.setPlaying(!1,!0),a.setActive(!1))}}else this._currentTrack.setPlaying(!0);this._handleTrackTimeUpdate(),this._handlePlayingStateChange()},e.prototype._selectRelativeTrack=function(e){var t=this._tracks.indexOf(this._currentTrack)+e;this._tracks[t]&&this._selectTrack(this._tracks[t])},e.prototype._togglePlay=function(){this._currentTrack.isPlaying?(this._currentTrack.setPlaying(!1),this._handleTrackTimeUpdate(),this._handlePlayingStateChange()):(this._currentTrack.restart(),this._selectTrack(this._currentTrack))},e.prototype._parseTracks=function(){var e=this,t=this.wrapper.firstElementChild;if(!(t instanceof HTMLUListElement))return console.error(".waveform-player with no ul child"),null;this._listUl=t,this._listUl.className="waveform-player-track-list";for(var i=[],a=0;a<this._listUl.childNodes.length;a++)if("LI"===this._listUl.childNodes[a].nodeName){for(var n=this._listUl.childNodes[a],s=void 0,o=void 0,l=0,h=0;h<n.childNodes.length;h++){var d=n.childNodes[h];if(d.nodeType===Node.TEXT_NODE){if(""!==d.nodeValue.trim())return console.error("Illegal text child of track list <li> item, expected one <a> element then one <div> element",d),null}else if(d.nodeType===Node.ELEMENT_NODE){if(0===l){if(!(d instanceof HTMLAnchorElement))return console.error("Illegal child of track list <li> item, element "+(h+1)+" to be a <a> but it was a <"+d.nodeName.toLowerCase()+">",d),null;s=d}else{if(1!==l)return console.error("Illegal child of track list <li> item, expected only 2 child elements but found element "+(h+1)+" which is a <"+d.nodeName.toLowerCase()+">",d),null;if(!(d instanceof HTMLDivElement))return console.error("Illegal child of track list <li> item, element index "+(h+1)+" to be a <div> but it was a <"+d.nodeName.toLowerCase()+">",d),null;o=d}++l}}if(!s)return console.error("Track list <li> item gas no link child"),null;s.className="waveform-player-track-list-link";var c=s.getAttribute("data-peaks");null!==c&&""!==c||(console.error('<a href="'+s.href+'"> track has no data-peaks attribute.'),c="0");var p=u(c,s.href);o||(o=document.createElement("div"),n.appendChild(o)),o.style.visibility="hidden",o.className="waveform-player-track-list-item-description";var _=this._parseDescriptionSubsections(o,s.href),m=new r.Track(s.href,n,o,p,_);m.ontimeupdate=this._handleTrackTimeUpdate.bind(this),m.onended=this._handleTrackEnded.bind(this),m.onbufferingchange=this._handleTrackBufferingChange.bind(this),i.push(m),this._trackByAudioSrc[s.href]&&console.error('More than one track has the url "'+s.href+'"'),this._trackByAudioSrc[s.href]=m}return requestAnimationFrame(function(){for(var t=e.wrapper.getElementsByClassName("waveform-player-track-list-item-description"),i=0;i<t.length;i++)t[i].style.visibility=""}),i},e.prototype._parseDescriptionSubsections=function(e,t){for(var i,r=[],a=e.getElementsByClassName("subsection"),n=0;n<a.length;n++){var s=a[n],o=s.textContent.trim().replace(/\s+/g," "),l=o.match(/^(\d:\d\d(?:\.\d+)?)\s*(?:(?:-|to)\s*(\d:\d\d(?:\.\d+)?))?\s*(?::|-)?\s*(.*)/i);if(l){var h=document.createElement("a");for(h.href=t,h.className="waveform-player-subsection-play";s.childNodes.length>0;)h.appendChild(s.firstChild);s.appendChild(h);var u={startTime:d(l[1]),endTime:d(l[2]),title:l[3],element:s};h.setAttribute("data-start-time",String(u.startTime)),r.push(u),i&&null===i.endTime&&(i.endTime=u.startTime),i=u}else console.error('Subsection doesn\'t have correct text format "1:23 - title" or "1:23 to 4:56 - title": "'+o+'"')}return r;function d(e){if(!e)return null;var t=e.split(":"),i=t[0],r=t[1];return 60*parseFloat(i)+parseFloat(r)}},e.prototype._onWaveformPositionSelect=function(e){this._currentTrack.setRelativePosition(e),this._currentTrack.setPlaying(!0),this._handlePlayingStateChange()},e.prototype._handleTrackTimeUpdate=function(e){if(void 0===e&&(e=this._currentTrack),e===this._currentTrack)if(this._currentTrack.isBuffering?this._currentTimeDiv.innerHTML="loading...":this._currentTimeDiv.innerHTML=i(this._currentTrack.currentTime),isNaN(this._currentTrack.totalTime))this._totalTimeDiv.style.opacity="0";else{this._totalTimeDiv.style.opacity="1",this._totalTimeDiv.innerHTML=i(this._currentTrack.totalTime);var t=this._currentTrack.isPlaying?1:0;this._waveform.setPlayheadPosition(this._currentTrack.currentTime,this._currentTrack.totalTime,t)}function i(e){if(isNaN(e))return"...";var t=Math.floor(e/60),i=String(Math.round(e-60*t));return 1===i.length&&(i="0"+i),t+":"+i}},e.prototype._handleTrackBufferingChange=function(e){e===this._currentTrack&&(this._handleTrackTimeUpdate(e),this._handlePlayingStateChange())},e.prototype._handleTrackEnded=function(e){this._currentTrack===e&&this._selectRelativeTrack(1)},e}();function u(e,t){for(var i=s.toByteArray(e),r=a.makeNumberArray(i.length),n=0;n<r.length;n++)r[n]=i[n]/255;return r}i.Player=h},{"./Track":3,"./WaveformRenderer":4,"./shared":6,"base64-js":1}],3:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=null,a=null,n="AudioContext"in window||"webkitAudioContext"in window,s=function(){function e(e,t,i,r,a){var s=this;this.audioSrc=e,this._listItem=t,this._description=i,this.peakData=r,this.subsections=a,this._playing=!1,this._waitingForAudioStart=!1,this._active=!1,this._resumeTime=0,this._buffering=!1,this._playingLastBufferCheck=!1,this._frequencyDomainData=null,this.ontimeupdate=null,this.onended=null,this.onbufferingchange=null,this._handleTimeUpdate=function(){s._updateSubsectionDisplay(),s._audio.currentTime>0&&(s._waitingForAudioStart=!1),s.ontimeupdate&&s.ontimeupdate(s)},this._handleEnded=function(){s.onended&&s.onended(s)},this._handleStoppedDueToError=function(){s._waitingForAudioStart=!0},this._checkPlayState=function(){var e=s._playing&&s._playingLastBufferCheck&&s.currentTime===s._timeLastBufferCheck&&!s._audio.ended;s._buffering!==e&&(s._buffering=e,s.onbufferingchange&&s.onbufferingchange(s)),s._playingLastBufferCheck=s._playing,s._timeLastBufferCheck=s.currentTime},this._nextFFTRenderScheduled=!1,this._metaSrc=e.replace(/\.\w+$/,".meta"),this._audio=document.createElement("audio"),this._audio.preload="metadata",this._audio.src=e,this._audio.addEventListener("timeupdate",this._handleTimeUpdate),this._audio.addEventListener("loadedmetadata",this._handleTimeUpdate),this._audio.addEventListener("end",this._handleEnded),this._audio.addEventListener("error",this._handleStoppedDueToError),this._audio.addEventListener("stalled",this._handleStoppedDueToError),document.body.appendChild(this._audio),this._audio.load(),a.sort(function(e,t){return e.startTime-t.startTime}),this._updateClass(),this._updateSubsectionDisplay(),n&&(this._fftCanvas=document.createElement("canvas"),this._fftCanvas.className="waveform-player-track-fft-canvas",this._listItem.firstElementChild.appendChild(this._fftCanvas),this._fftContext=this._fftCanvas.getContext("2d"))}return e.prototype.setPlaying=function(e,t){t&&(this._resumeTime=0),e?(n&&this._setupAudioContext(),this._waitingForAudioStart=!0,this._audio.currentTime=this._resumeTime||0,this._audio.play()):(this._resumeTime=this._audio.currentTime,this._waitingForAudioStart&&(this._audio.src=this._audio.src)),e!==this._playing&&(this._playing=e,e?(n&&(this._audioSource.connect(a),this._audioSource.connect(r.destination),this._startFFTRenderLoop()),this._playStateDetectionInterval=setInterval(this._checkPlayState,1e3),this._checkPlayState()):(this._audio.pause(),clearInterval(this._playStateDetectionInterval),this._checkPlayState()),this._updateClass())},e.prototype.setActive=function(e){e!==this._active&&(this._active=e,this._updateClass())},e.prototype.setRelativePosition=function(e){this._resumeTime=this._audio.duration*e||0,this._audio.play(),this._audio.currentTime=this._resumeTime},e.prototype.setCurrentTime=function(e){this._audio.currentTime=e||0},e.prototype.restart=function(){this._audio.currentTime=0},e.prototype.update=function(){this._updateDescriptionMaxHeight()},Object.defineProperty(e.prototype,"isPlaying",{get:function(){return this._playing},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBuffering",{get:function(){return this._buffering},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._audio.currentTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalTime",{get:function(){return this._audio.duration},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){return this._description},enumerable:!0,configurable:!0}),e.prototype._updateDescriptionMaxHeight=function(){var e=0;this._playing&&(e=this._description.scrollHeight),this._descriptionMaxHeight!==e&&(this._descriptionMaxHeight=e,this._description.style.maxHeight=e+"px")},e.prototype._updateSubsectionDisplay=function(){for(var e=null,t=0,i=this.subsections;t<i.length;t++){var r=i[t];null===e&&r.startTime<=this.currentTime&&(!r.endTime||r.endTime>this.currentTime)?(e=r).element.className="waveform-player-subsection waveform-player-active-subsection":r.element.className="waveform-player-subsection"}},e.prototype._updateClass=function(){var e="waveform-player-track-list-item";this._active&&(e+=" waveform-player-track-list-item-active"),this._playing&&(e+=" waveform-player-track-list-item-playing"),this._listItem.className=e,this._updateDescriptionMaxHeight()},e.prototype._setupAudioContext=function(){this._audioSource||(null===r&&(r=new(window.AudioContext||window.webkitAudioContext),(a=r.createAnalyser()).minDecibels=-70,a.maxDecibels=-20,a.smoothingTimeConstant=.5),this._audioSource=r.createMediaElementSource(this._audio))},e.prototype._startFFTRenderLoop=function(){var e=this,t=function(){e._renderFFT(),e._playing&&!e._nextFFTRenderScheduled&&(e._nextFFTRenderScheduled=!0,requestAnimationFrame(t))};t()},e.prototype._renderFFT=function(){this._nextFFTRenderScheduled=!1;var e=this._fftCanvas.offsetWidth,t=this._fftCanvas.offsetHeight;this._fftCanvas.width===e&&this._fftCanvas.height===t||(this._fftCanvas.width=e,this._fftCanvas.height=t);var i=this._fftContext;if(i.clearRect(0,0,e,t),this._playing){this._frequencyDomainData||(this._frequencyDomainData=new Uint8Array(a.frequencyBinCount)),a.getByteFrequencyData(this._frequencyDomainData);for(var r=[],n=1,s=0;;){for(var o=0,l=0;l<n;l++)o+=this._frequencyDomainData[s++];if(s>this._frequencyDomainData.length)break;r.push(o/n/255),n*=1.3}i.fillStyle="rgba(255, 255, 255, 0.1)";for(var h=e/r.length,u=0;u<r.length;u++)i.fillRect(h*u,t,.9*h,-r[u]*t),n*=1.3}},e}();i.Track=s},{}],4:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=e("./shared"),a=function(){function e(e){this._canvas=e,this._rawCurrentPeaks=[0],this._rawPreviousPeaks=[0],this._resampledCurrentPeaks=[0],this._resampledPreviousPeaks=[0],this._transitioningPeaks=[0],this._peakDataTransitionStartTime=0,this._transitionProgress=1,this._previousTransitionProgress=1,this._previousPlayheadPosition=0,this._renderLoopRunning=!1,this._nextRenderIsScheduled=!1,this._playheadPosition=0,this._playheadSmoothing=!1,this._playheadSmoothingStartTime=0,this._playheadSmoothingDuration=0,this._playheadSmoothingPlayLength=0,this._hasCurrentInteraction=!1,this._mousePosition=0,this._highlightPosition=0,this._colours={upperUnplayed:"#DDD",lowerUnplayed:"#FFF",upperPlayed:"#AAA",lowerPlayed:"#CCC",mouseoverUpperPlayed:"#888",mouseoverLowerPlayed:"#AAA"},this._handleWindowResizeDelegate=this._handleWindowResize.bind(this),this._ctx=e.getContext("2d"),this._render(),window.addEventListener("resize",this._handleWindowResizeDelegate),this._setupInteractionHandlers()}return e.prototype.destroy=function(){window.removeEventListener("resize",this._handleWindowResizeDelegate)},e.prototype.setPeakData=function(e){1===this._transitionProgress?(this._previousPlayheadPosition=this._getSmoothedPlayheadPosition(),this._playheadPosition=0,this._playheadSmoothing=!1,this._rawPreviousPeaks=this._rawCurrentPeaks,this._resampledPreviousPeaks=this._resampledCurrentPeaks,this._rawCurrentPeaks=e,this._resampledCurrentPeaks=null,this._peakDataTransitionStartTime=Date.now(),this._startRenderLoop()):this._rawQueuedPeakData=e},e.prototype.setPlayheadPosition=function(e,t,i){void 0===i&&(i=0),this._playheadPosition=e/t,i?(this._playheadSmoothing=!0,this._playheadSmoothingStartTime=Date.now(),this._playheadSmoothingPlayLength=t,this._playheadSmoothingDuration=i):this._playheadSmoothing=!1,this._startRenderLoop()},e.prototype.setHighlightPosition=function(e,t){this._highlightPosition=e/t,this._startRenderLoop()},e.prototype.clearHighlightPosition=function(){this._highlightPosition=0,this._startRenderLoop()},e.prototype.setColours=function(e){this._colours=e},e.prototype._startRenderLoop=function(){this._renderLoopRunning||(this._renderLoopRunning=!0,this._render())},e.prototype._render=function(){this._nextRenderIsScheduled=!1;var e=Math.ceil(this._canvas.offsetWidth*(window.devicePixelRatio||1)),t=Math.ceil(this._canvas.offsetHeight*(window.devicePixelRatio||1)),i=this._resizeCanvas(e,t);this._transitionProgress=Math.min(1,(Date.now()-this._peakDataTransitionStartTime)/1e3/.6),(this._transitionProgress<1||this._previousTransitionProgress<1||i||this._rawLastRenderedPeaks!==this._rawCurrentPeaks)&&this._redrawPeakShape(e,t),this._redrawColors(e,t),this._transitionProgress>=1&&(this._rawQueuedPeakData?(this.setPeakData(this._rawQueuedPeakData),this._rawQueuedPeakData=null):this._renderLoopRunning=this._playheadSmoothingIsActive),this._previousTransitionProgress=this._transitionProgress,this._renderLoopRunning&&!this._nextRenderIsScheduled&&(this._nextRenderIsScheduled=!0,requestAnimationFrame(this._render.bind(this)))},e.prototype._resizeCanvas=function(e,t){e=Math.min(e,1e4),t=Math.min(t,1e4);var i=!1;return this._canvas.width===e&&this._canvas.height===t||(this._canvas.width=e,this._canvas.height=t,i=!0,this._resampledCurrentPeaks=null,this._resampledPreviousPeaks=null),this._resampledCurrentPeaks||(this._resampledCurrentPeaks=r.makeNumberArray(e/1),s(this._rawCurrentPeaks,this._resampledCurrentPeaks)),this._resampledPreviousPeaks||(this._resampledPreviousPeaks=r.makeNumberArray(e/1),s(this._rawPreviousPeaks,this._resampledPreviousPeaks)),i},e.prototype._getSmoothedPlayheadPosition=function(){var e=this._playheadPosition;if(this._playheadSmoothingIsActive=!1,this._playheadSmoothing){var t=(Date.now()-this._playheadSmoothingStartTime)/1e3;t<this._playheadSmoothingDuration&&(this._playheadSmoothingIsActive=!0),e+=t/this._playheadSmoothingPlayLength}return Math.min(1,Math.max(0,e))},e.prototype._redrawPeakShape=function(e,t){this._updateTransitioningPeaks();var i=this._transitioningPeaks,r=i.length,a=Math.ceil(t/2)+1,n=a-2,s=this._ctx;s.clearRect(0,0,e,t),s.beginPath(),s.moveTo(0,a);for(var o=e/i.length,l=0;l<r;l++)s.lineTo(l*o,n-i[l]*n);s.lineTo(e,a),s.closePath(),s.fillStyle="#FF0088",s.fill(),s.save(),s.translate(0,Math.round(t/2)),s.scale(1,-1),this._ctx.drawImage(this._canvas,0,-Math.round(t/2),e,t),s.restore(),this._rawLastRenderedPeaks=this._rawCurrentPeaks},e.prototype._redrawColors=function(e,t){var i=this._ctx;i.globalCompositeOperation="source-atop";var r=this._getSmoothedPlayheadPosition();function a(r,a,n,s){void 0===s&&(s=0);var o=i.createLinearGradient(0,0,0,t);o.addColorStop(0,r),o.addColorStop(1,a),i.fillStyle=o,i.fillRect(e*n,0,e*(s-n),t)}a(this._colours.upperUnplayed,this._colours.lowerUnplayed,1),a(this._colours.upperPlayed,this._colours.lowerPlayed,r),this._previousPlayheadPosition>r&&this._transitionProgress,this._hasCurrentInteraction?a(this._colours.mouseoverUpperPlayed,this._colours.mouseoverLowerPlayed,this._mousePosition,r):this._highlightPosition&&a(this._colours.mouseoverUpperPlayed,this._colours.mouseoverLowerPlayed,this._highlightPosition,r),i.globalCompositeOperation="source-over"},e.prototype._setupInteractionHandlers=function(){var e=this,t=function(t,i,r,a){t.preventDefault(),e._hasCurrentInteraction=i;var n=e._canvas.getBoundingClientRect();a&&(e._mousePosition=(a.pageX-n.left)/n.width),e._startRenderLoop(),r&&e.onpositionselect&&e.onpositionselect(e._mousePosition)};this._canvas.addEventListener("mouseover",function(e){return t(e,!0,!1,e)}),this._canvas.addEventListener("mousemove",function(e){return t(e,!0,!1,e)}),this._canvas.addEventListener("mouseout",function(e){return t(e,!1,!1,e)}),this._canvas.addEventListener("mouseup",function(e){return t(e,!0,!0,e)}),this._canvas.addEventListener("touchstart",function(e){return t(e,!0,!1,e.targetTouches[0])}),this._canvas.addEventListener("touchmove",function(e){return t(e,!0,!1,e.targetTouches[0])}),this._canvas.addEventListener("touchend",function(e){return t(e,!1,!0,e.targetTouches[0])})},e.prototype._handleWindowResize=function(){!document.body||this._canvas.compareDocumentPosition(document.body)&Node.DOCUMENT_POSITION_DISCONNECTED||this._startRenderLoop()},e.prototype._updateTransitioningPeaks=function(){this._transitioningPeaks.length!==this._resampledCurrentPeaks.length&&(this._transitioningPeaks=r.makeNumberArray(this._resampledCurrentPeaks.length));for(var e,t,i,a=this._resampledPreviousPeaks,s=this._resampledCurrentPeaks,o=this._transitioningPeaks,l=s.length,h=2*Math.PI*5,u=0;u<l;u++){var d=(e=this._transitionProgress,void 0,i=u/l*(1-1/(t=2)),n(Math.min(1,Math.max(0,(e-i)*t)))),c=n(1-Math.abs(2*d-1)),p=this._resampledPreviousPeaks[u]+(s[u]-a[u])*n(d);p+=Math.sin(u/l*h)*c*.35,o[u]=Math.max(0,Math.min(1,p))}},e}();function n(e){if(e<.5)return e*e*2;var t=1-e;return 1-t*t*2}function s(e,t){if(e.length===t.length)for(var i=0;i<e.length;i++)t[i]=e[i];else if(e.length>t.length){var r=(h=e.length/t.length)/2,a=r;for(i=0;i<t.length;i++){var n=Math.floor(a-r),s=Math.min(Math.ceil(a+r),e.length);a+=h;for(var o=0,l=n;l<s;l++)o=Math.max(o,e[l]);t[i]=o}}else{var h=(e.length-1)/t.length;for(i=0;i<t.length;i++){a=i*h;var u=Math.floor(a),d=a-u,c=Math.max(u,0),p=Math.min(u+1,e.length-1),_=(1-d)*e[c]+d*e[p];t[i]=_}}}i.WaveformRenderer=a},{"./shared":6}],5:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=e("./Player"),a="waveform-player",n=0,s={};function o(){for(var e=document.getElementsByClassName(a),t={},i=0;i<e.length;i++){var o=e[i];if(o instanceof HTMLDivElement){if(o.hasAttribute("data-disable-waveform-player"))continue;if(null===(u=o.getAttribute("data-waveform-player-id"))){u=String(++n);var h=new r.Player(o);h.onplay=l,s[u]=h,o.setAttribute("data-waveform-player-id",u)}t[u]=!0}else console.error(a+" class attribute is only supported on div elements!")}for(var u in s)t[u]||(s[u].destroy(),delete s[u])}function l(e){for(var t in s)s[t]!==e&&s[t].setPlaying(!1)}i.initialiseWaveformPlayers=o,window.initialiseWaveformPlayers=o;var h=!1;function u(){h||"loading"===document.readyState||(h=!0,o())}document.addEventListener("readystatechange",u),u()},{"./Player":2}],6:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.makeNumberArray=function(e){return"Float32Array"in window?new Float32Array(e):new Array(e)}},{}]},{},[5]);